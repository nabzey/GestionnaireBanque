# üè¶ API Banque - Syst√®me Bancaire Complet

## üìã Description

Une API REST compl√®te pour un syst√®me bancaire moderne d√©velopp√©e avec Laravel 11.x, utilisant Laravel Passport pour l'authentification OAuth2. L'API g√®re les clients, comptes bancaires et transactions avec une architecture s√©curis√©e et scalable.

## üöÄ Fonctionnalit√©s Principales

### üë• Gestion des Clients
- **CRUD complet** : Cr√©ation, lecture, mise √† jour, suppression
- **UUID comme cl√© primaire** pour s√©curit√© renforc√©e
- **Soft deletes** pour archivage logique
- **Profils complets** : nom, pr√©nom, email, t√©l√©phone, adresse, etc.
- **Statuts** : actif, inactif, suspendu

### üí≥ Gestion des Comptes
- **Types de comptes** : Ch√®que, Courant, √âpargne
- **Filtrage automatique** : Comptes actifs uniquement (type ch√®que/√©pargne)
- **Num√©ros uniques** g√©n√©r√©s automatiquement (format: CPT-XXXXXXXX)
- **Gestion des statuts** : actif, bloqu√©, ferm√©
- **Soft deletes** avec archivage
- **Liens avec clients** via relations Eloquent

### üí∏ Gestion des Transactions
- **Types** : D√©p√¥t, Retrait, Virement, Transfert
- **R√©f√©rences uniques** g√©n√©r√©es automatiquement
- **Montants avec devises** multiples (FCFA, EUR, USD)
- **Statuts** : En attente, Valid√©e, Rejet√©e, Annul√©e
- **Historique complet** avec dates d'ex√©cution

### üîê Authentification & Autorisation
- **Laravel Passport** pour OAuth2
- **R√¥les diff√©renci√©s** :
  - **Admin** : Acc√®s complet √† toutes les ressources
  - **Client** : Acc√®s limit√© √† ses propres donn√©es
- **Middleware personnalis√©** pour contr√¥le des r√¥les
- **Rate limiting** : 60 requ√™tes/minute

### üìä API Avanc√©e
- **Pagination HATEOAS** avec liens de navigation
- **Filtrage et recherche** avanc√©s
- **Tri multiple** sur tous les champs
- **R√©ponses JSON structur√©es**
- **Gestion d'erreurs** compl√®te
- **Documentation Swagger/OpenAPI**

---

## üõ†Ô∏è Installation & Configuration

### Pr√©requis
- PHP 8.1+
- Composer
- MySQL/PostgreSQL
- Laravel 11.x

### Installation

```bash
# Cloner le repository
git clone <repository-url>
cd banque-api

# Installer les d√©pendances
composer install

# Configuration de l'environnement
cp .env.example .env
php artisan key:generate

# Configuration de la base de donn√©es dans .env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=banque_api
DB_USERNAME=votre_username
DB_PASSWORD=votre_password

# Migration et seeding
php artisan migrate
php artisan db:seed

# Installation de Passport
php artisan passport:install

# D√©marrage du serveur
php artisan serve
```

### Configuration Passport

```bash
# Cr√©er les cl√©s OAuth2
php artisan passport:install

# Les clients API seront cr√©√©s automatiquement
# Client ID et Secret disponibles dans la table oauth_clients
```

---

## üìö Architecture & Structure

### üìÅ Structure des Dossiers

```
app/
‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/Api/V1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompteController.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TransactionController.php
‚îÇ   ‚îú‚îÄ‚îÄ Middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoleMiddleware.php
‚îÇ   ‚îú‚îÄ‚îÄ Requests/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StoreClientRequest.php
‚îÇ   ‚îî‚îÄ‚îÄ Resources/
‚îÇ       ‚îú‚îÄ‚îÄ CompteResource.php
‚îÇ       ‚îî‚îÄ‚îÄ TransactionResource.php
‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îú‚îÄ‚îÄ Client.php
‚îÇ   ‚îú‚îÄ‚îÄ Compte.php
‚îÇ   ‚îî‚îÄ‚îÄ Transaction.php
‚îú‚îÄ‚îÄ Scopes/
‚îÇ   ‚îî‚îÄ‚îÄ CompteScope.php
‚îî‚îÄ‚îÄ Traits/
    ‚îî‚îÄ‚îÄ ApiResponseTrait.php

database/
‚îú‚îÄ‚îÄ factories/
‚îÇ   ‚îú‚îÄ‚îÄ ClientFactory.php
‚îÇ   ‚îú‚îÄ‚îÄ CompteFactory.php
‚îÇ   ‚îî‚îÄ‚îÄ TransactionFactory.php
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ create_clients_table.php
‚îÇ   ‚îú‚îÄ‚îÄ create_comptes_table.php
‚îÇ   ‚îú‚îÄ‚îÄ create_transactions_table.php
‚îÇ   ‚îî‚îÄ‚îÄ modify_comptes_table_change_foreign_key_to_client.php
‚îî‚îÄ‚îÄ seeders/
    ‚îú‚îÄ‚îÄ ClientSeeder.php
    ‚îú‚îÄ‚îÄ CompteSeeder.php
    ‚îî‚îÄ‚îÄ TransactionSeeder.php

routes/
‚îî‚îÄ‚îÄ api.php
```

### üóÑÔ∏è Sch√©ma Base de Donn√©es

#### Table `clients`
```sql
- id (UUID, Primary Key)
- nom (VARCHAR)
- prenom (VARCHAR)
- email (VARCHAR, UNIQUE)
- telephone (VARCHAR, UNIQUE)
- date_naissance (DATE, NULLABLE)
- adresse (VARCHAR, NULLABLE)
- ville (VARCHAR, NULLABLE)
- pays (VARCHAR, DEFAULT 'S√©n√©gal')
- statut (ENUM: actif, inactif, suspendu)
- metadata (JSON, NULLABLE)
- deleted_at (TIMESTAMP, NULLABLE)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

INDEXES: (nom, prenom), email, telephone, statut
```

#### Table `comptes`
```sql
- id (UUID, Primary Key)
- numero (VARCHAR, UNIQUE)
- solde_initial (DECIMAL 15,2)
- devise (VARCHAR, DEFAULT 'FCFA')
- type (ENUM: cheque, courant, epargne)
- statut (ENUM: actif, bloque, ferme)
- motif_blocage (TEXT, NULLABLE)
- metadata (JSON, NULLABLE)
- client_id (BIGINT, FOREIGN KEY -> clients.id)
- deleted_at (TIMESTAMP, NULLABLE)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

INDEXES: (client_id, type), numero, devise, statut
```

#### Table `transactions`
```sql
- id (UUID, Primary Key)
- reference (VARCHAR, UNIQUE)
- type (ENUM: depot, retrait, virement, transfert)
- montant (DECIMAL 15,2)
- devise (VARCHAR, DEFAULT 'FCFA')
- description (TEXT, NULLABLE)
- statut (ENUM: en_attente, validee, rejete, annulee)
- date_execution (TIMESTAMP, NULLABLE)
- metadata (JSON, NULLABLE)
- compte_id (BIGINT, FOREIGN KEY -> comptes.id)
- deleted_at (TIMESTAMP, NULLABLE)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

INDEXES: (compte_id, type), reference, statut, date_execution
```

---

## üåê API Endpoints

### Base URL
```
http://localhost:8000/api/v1/zeynab-ba
```

### üîë Authentification
Tous les endpoints n√©cessitent un token Bearer OAuth2 :
```
Authorization: Bearer {access_token}
```

---

## üí≥ 1. GESTION DES COMPTES

### `GET /comptes` - Liste des comptes actifs
**Description** : R√©cup√®re la liste des comptes actifs (filtr√©s automatiquement)

**Authentification** : Requise
- **Admin** : Voit tous les comptes
- **Client** : Voit uniquement ses comptes

**Param√®tres de requ√™te** :
```javascript
{
  "page": 1,           // Num√©ro de page (d√©faut: 1)
  "limit": 10,         // √âl√©ments par page (max: 100, d√©faut: 10)
  "type": "cheque",    // Filtrer par type (cheque, epargne)
  "statut": "actif",   // Filtrer par statut (actif, bloque, ferme)
  "search": "amadou",  // Recherche par titulaire ou num√©ro
  "sort": "created_at", // Tri (dateCreation, solde, titulaire)
  "order": "desc"      // Ordre (asc, desc)
}
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "_links": {
      "self": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes?page=1", "method": "GET"},
      "first": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes?page=1", "method": "GET"},
      "last": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes?page=3", "method": "GET"}
    },
    "_embedded": {
      "comptes": [
        {
          "id": "uuid-compte-1",
          "numeroCompte": "CPT-CHQ001",
          "titulaire": "Amadou Diop",
          "type": "cheque",
          "solde": 500000,
          "devise": "FCFA",
          "dateCreation": "2025-01-15T10:30:00.000000Z",
          "statut": "actif",
          "motifBlocage": null,
          "metadata": {"version": 1},
          "_links": {
            "self": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "GET"},
            "update": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "PUT"},
            "delete": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "DELETE"}
          }
        }
      ]
    },
    "pagination": {
      "currentPage": 1,
      "totalPages": 3,
      "totalItems": 25,
      "itemsPerPage": 10,
      "hasNext": true,
      "hasPrevious": false
    }
  },
  "message": "Liste des comptes r√©cup√©r√©e avec succ√®s"
}
```

### `GET /comptes/{id}` - D√©tails d'un compte
**Description** : R√©cup√®re les d√©tails d'un compte sp√©cifique

**Authentification** : Requise avec v√©rification propri√©taire

**Param√®tres** :
- `id` (string, UUID) : ID du compte

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "id": "uuid-compte-1",
    "numeroCompte": "CPT-CHQ001",
    "titulaire": "Amadou Diop",
    "type": "cheque",
    "solde": 500000,
    "devise": "FCFA",
    "dateCreation": "2025-01-15T10:30:00.000000Z",
    "statut": "actif",
    "motifBlocage": null,
    "metadata": {"version": 1},
    "_links": {
      "self": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "GET"},
      "update": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "PUT"},
      "delete": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "DELETE"},
      "collection": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes", "method": "GET"}
    }
  },
  "message": "D√©tails du compte r√©cup√©r√©s avec succ√®s"
}
```

### `POST /comptes` - Cr√©er un compte
**Description** : Cr√©e un nouveau compte bancaire

**Authentification** : Admin seulement

**Corps de la requ√™te** :
```json
{
  "client_id": "uuid-client-1",
  "type": "cheque",
  "devise": "FCFA",
  "solde_initial": 100000,
  "statut": "actif"
}
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "id": "uuid-nouveau-compte",
    "numeroCompte": "CPT-CHQ025",
    "titulaire": "Amadou Diop",
    "type": "cheque",
    "solde": 100000,
    "devise": "FCFA",
    "dateCreation": "2025-01-25T14:30:00.000000Z",
    "statut": "actif",
    "_links": {
      "self": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-nouveau-compte", "method": "GET"}
    }
  },
  "message": "Compte cr√©√© avec succ√®s"
}
```

### `PUT /comptes/{id}` - Modifier un compte
**Description** : Met √† jour les informations d'un compte

**Authentification** : Admin seulement

### `DELETE /comptes/{id}` - Supprimer un compte
**Description** : Supprime logiquement un compte (soft delete)

**Authentification** : Admin seulement

### `GET /comptes-archives` - Comptes archiv√©s (Cloud)
**Description** : Liste des comptes supprim√©s (soft deleted)

**Authentification** : Admin seulement

**Note** : Simule un acc√®s aux donn√©es archiv√©es dans le cloud

---

## üí∏ 2. GESTION DES TRANSACTIONS

### `GET /transactions` - Liste des transactions
**Description** : R√©cup√®re la liste des transactions

**Authentification** : Requise
- **Admin** : Voit toutes les transactions
- **Client** : Voit uniquement les transactions de ses comptes

**Param√®tres de requ√™te** :
```javascript
{
  "page": 1,
  "limit": 10,
  "type": "depot",           // depot, retrait, virement, transfert
  "statut": "validee",       // en_attente, validee, rejete, annulee
  "compte_id": "uuid-compte",
  "search": "salaire",       // Recherche dans r√©f√©rence ou description
  "sort": "date_execution",  // date_execution, montant, created_at
  "order": "desc"
}
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "_links": {
      "self": {"href": "http://localhost:8000/api/v1/zeynab-ba/transactions?page=1", "method": "GET"},
      "first": {"href": "http://localhost:8000/api/v1/zeynab-ba/transactions?page=1", "method": "GET"},
      "last": {"href": "http://localhost:8000/api/v1/zeynab-ba/transactions?page=5", "method": "GET"}
    },
    "_embedded": {
      "transactions": [
        {
          "id": "uuid-transaction-1",
          "reference": "TXN-DEPOSIT001",
          "type": "depot",
          "montant": 500000,
          "montant_formate": "500 000 FCFA",
          "devise": "FCFA",
          "description": "D√©p√¥t initial de salaire",
          "statut": "validee",
          "date_execution": "2025-01-15T10:30:00.000000Z",
          "date_creation": "2025-01-15T10:25:00.000000Z",
          "derniere_modification": "2025-01-15T10:30:00.000000Z",
          "metadata": {"version": 1},
          "compte": {
            "id": "uuid-compte-1",
            "numero": "CPT-CHQ001",
            "type": "cheque",
            "solde_initial": 500000,
            "devise": "FCFA",
            "titulaire": "Amadou Diop"
          },
          "_links": {
            "self": {"href": "http://localhost:8000/api/v1/zeynab-ba/transactions/uuid-transaction-1", "method": "GET"},
            "collection": {"href": "http://localhost:8000/api/v1/zeynab-ba/transactions", "method": "GET"},
            "compte": {"href": "http://localhost:8000/api/v1/zeynab-ba/comptes/uuid-compte-1", "method": "GET"}
          }
        }
      ]
    },
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalItems": 47,
      "itemsPerPage": 10,
      "hasNext": true,
      "hasPrevious": false
    }
  },
  "message": "Liste des transactions r√©cup√©r√©e avec succ√®s"
}
```

---

## üë• 3. GESTION DES CLIENTS (FUTUR)

> **Note** : Les endpoints clients ne sont pas encore impl√©ment√©s dans cette version, mais la structure est pr√™te.

### Endpoints pr√©vus :
- `GET /clients` - Liste des clients (Admin)
- `POST /clients` - Cr√©er un client (Admin)
- `GET /clients/{id}` - D√©tails client (Admin)
- `PUT /clients/{id}` - Modifier client (Admin)
- `DELETE /clients/{id}` - Supprimer client (Admin)

---

## üîê Authentification OAuth2

### Obtenir un token d'acc√®s

```bash
# Via cURL
curl -X POST http://localhost:8000/oauth/token \
  -H "Content-Type: application/json" \
  -d '{
    "grant_type": "password",
    "client_id": "your-client-id",
    "client_secret": "your-client-secret",
    "username": "user@example.com",
    "password": "password",
    "scope": "*"
  }'
```

### Utiliser le token

```bash
curl -X GET http://localhost:8000/api/v1/zeynab-ba/comptes \
  -H "Authorization: Bearer your-access-token" \
  -H "Accept: application/json"
```

---

## üìä Donn√©es de Test

### Clients pr√©d√©finis (Seeder)
```php
[
    ['nom' => 'Diop', 'prenom' => 'Amadou', 'email' => 'amadou.diop@example.com', 'telephone' => '+221771234567'],
    ['nom' => 'Ndiaye', 'prenom' => 'Fatou', 'email' => 'fatou.ndiaye@example.com', 'telephone' => '+221772345678'],
    ['nom' => 'Sow', 'prenom' => 'Mamadou', 'email' => 'mamadou.sow@example.com', 'telephone' => '+221773456789'],
    ['nom' => 'Ba', 'prenom' => 'Aissatou', 'email' => 'aissatou.ba@example.com', 'telephone' => '+221774567890'],
    ['nom' => 'Gueye', 'prenom' => 'Ibrahima', 'email' => 'ibrahima.gueye@example.com', 'telephone' => '+221775678901']
]
```

### Comptes pr√©d√©finis (Seeder)
```php
[
    ['numero' => 'CPT-CHQ001', 'solde_initial' => 500000, 'devise' => 'FCFA', 'type' => 'cheque'],
    ['numero' => 'CPT-CHQ002', 'solde_initial' => 750000, 'devise' => 'FCFA', 'type' => 'cheque'],
    ['numero' => 'CPT-CRT001', 'solde_initial' => 100000, 'devise' => 'EUR', 'type' => 'courant'],
    ['numero' => 'CPT-EPG001', 'solde_initial' => 200000, 'devise' => 'FCFA', 'type' => 'epargne'],
    ['numero' => 'CPT-CHQ003', 'solde_initial' => 300000, 'devise' => 'USD', 'type' => 'cheque']
]
```

### Transactions pr√©d√©finies (Seeder)
```php
[
    ['reference' => 'TXN-DEPOSIT001', 'type' => 'depot', 'montant' => 500000, 'devise' => 'FCFA', 'statut' => 'validee'],
    ['reference' => 'TXN-WITHDRAW001', 'type' => 'retrait', 'montant' => 100000, 'devise' => 'FCFA', 'statut' => 'validee'],
    ['reference' => 'TXN-TRANSFER001', 'type' => 'virement', 'montant' => 250000, 'devise' => 'FCFA', 'statut' => 'validee'],
    ['reference' => 'TXN-DEPOSIT002', 'type' => 'depot', 'montant' => 75000, 'devise' => 'EUR', 'statut' => 'validee'],
    ['reference' => 'TXN-PENDING001', 'type' => 'retrait', 'montant' => 50000, 'devise' => 'FCFA', 'statut' => 'en_attente']
]
```

---

## üß™ Tests & D√©veloppement

### Ex√©cution des seeders
```bash
# Peupler la base avec des donn√©es de test
php artisan db:seed

# Peupler seulement certains seeders
php artisan db:seed --class=ClientSeeder
php artisan db:seed --class=CompteSeeder
php artisan db:seed --class=TransactionSeeder
```

### Tests automatis√©s
```bash
# Ex√©cuter tous les tests
php artisan test

# Tests avec couverture
php artisan test --coverage
```

### G√©n√©ration de donn√©es factices
```bash
# Cr√©er 10 clients factices
php artisan tinker
>>> App\Models\Client::factory(10)->create()
>>> App\Models\Compte::factory(10)->create()
>>> App\Models\Transaction::factory(10)->create()
```

---

## üìñ Documentation API

### Swagger/OpenAPI
L'API est document√©e avec Swagger. Acc√©dez √† :
```
http://localhost:8000/api/documentation
```

### Postman Collection
Importez le fichier `postman_collection.json` pour tester l'API.

---

## üîß Configuration Avanc√©e

### Variables d'environnement (.env)
```env
# Base de donn√©es
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=banque_api
DB_USERNAME=your_username
DB_PASSWORD=your_password

# Passport
PASSPORT_PERSONAL_ACCESS_CLIENT_ID=1
PASSPORT_PERSONAL_ACCESS_CLIENT_SECRET=your-secret

# Rate Limiting
THROTTLE_RATE=60

# Pagination
DEFAULT_PAGINATION_LIMIT=10
MAX_PAGINATION_LIMIT=100
```

### Middleware personnalis√©
```php
// app/Http/Kernel.php
protected $middlewareAliases = [
    // ... autres middlewares
    'role' => \App\Http\Middleware\RoleMiddleware::class,
];
```

---

## üö® Gestion des Erreurs

### Codes d'erreur HTTP
- `200` : Succ√®s
- `201` : Cr√©√© avec succ√®s
- `400` : Donn√©es invalides
- `401` : Non authentifi√©
- `403` : Acc√®s refus√©
- `404` : Ressource non trouv√©e
- `422` : Erreur de validation
- `429` : Limite de taux d√©pass√©e
- `500` : Erreur serveur

### Structure des erreurs
```json
{
  "success": false,
  "message": "Description de l'erreur",
  "errors": {
    "champ1": ["Erreur 1", "Erreur 2"],
    "champ2": ["Erreur 3"]
  }
}
```

---

## üîç Monitoring & Logs

### Logs Laravel
```bash
# Voir les logs
tail -f storage/logs/laravel.log

# Logs par date
tail -f storage/logs/laravel-2025-01-25.log
```

### Rate Limiting
- Surveillance automatique des d√©passements
- Logs des IPs suspectes
- Possibilit√© de blocage automatique

---

## üöÄ D√©ploiement

### Pr√©paration pour la production
```bash
# Optimisation
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Migrations en production
php artisan migrate --force

# Permissions
chmod -R 755 storage/
chmod -R 755 bootstrap/cache/
```

### Variables de production
```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://api.banque.example.com

# Base de donn√©es production
DB_CONNECTION=mysql
DB_HOST=production-host
DB_DATABASE=banque_prod

# Passport production
PASSPORT_PERSONAL_ACCESS_CLIENT_ID=prod-client-id
PASSPORT_PERSONAL_ACCESS_CLIENT_SECRET=prod-client-secret
```

---

## ü§ù Contribution

1. Fork le projet
2. Cr√©er une branche feature (`git checkout -b feature/nouvelle-fonctionnalite`)
3. Commit les changements (`git commit -am 'Ajout nouvelle fonctionnalit√©'`)
4. Push la branche (`git push origin feature/nouvelle-fonctionnalite`)
5. Cr√©er une Pull Request

---

## üìÑ Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

---

## üìû Support

Pour toute question ou probl√®me :
- üìß Email : support@banque-api.com
- üìö Documentation : [Lien vers la doc compl√®te]
- üêõ Issues : [Lien vers GitHub Issues]

---

*D√©velopp√© avec ‚ù§Ô∏è par Zeynab BA - API Banque v1.0*